<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>LocalMediaSuite ‚Äì Flirt KI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --line:#243244; --text:#e5e7eb; --muted:#94a3b8;
      --ok:#10b981; --warn:#f59e0b; --bad:#ef4444; --accent:#22d3ee; --btn:#1e293b;
      --r:12px; --gap:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:15px/1.45 system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;display:flex;flex-direction:column}

    /* Topbar */
    header{position:sticky;top:0;z-index:10;background:#0f172acc;border-bottom:1px solid var(--line);backdrop-filter:blur(8px)}
    .top{display:flex;align-items:center;gap:10px;justify-content:center;padding:14px 20px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 12px var(--accent)}
    .brand{font-weight:900;letter-spacing:.2px}

    /* Layout */
    .wrap{max-width:1300px;margin:18px auto;padding:0 18px;display:grid;grid-template-columns:1fr 330px;gap:var(--gap);width:100%}
    @media (max-width:1100px){ .wrap{grid-template-columns:1fr} }

    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--r);overflow:hidden}
    .card-h{padding:12px 14px;border-bottom:1px solid var(--line);font-weight:700}
    .card-b{padding:14px}

    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px}
    .toolbar .field{display:flex;align-items:center;gap:8px;background:#0c1728;border:1px solid var(--line);padding:6px 10px;border-radius:9px}
    .toolbar select,.toolbar input{background:transparent;border:0;outline:none;color:var(--text)}
    .btn{background:var(--btn);border:1px solid var(--line);color:var(--text);padding:8px 14px;border-radius:10px;cursor:pointer}
    .btn:hover{filter:brightness(1.08)}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#03131c}
    .btn.danger{background:var(--bad);border-color:var(--bad);color:white}

    /* Chat */
    .chat{display:flex;flex-direction:column;height:min(70vh,620px)}
    .msgs{flex:1;overflow:auto;padding:14px;display:flex;flex-direction:column;gap:10px}
    .msg{max-width:85%;padding:10px 14px;border-radius:14px;line-height:1.35}
    .me{align-self:flex-end;background:#2563eb;color:white}
    .ai{align-self:flex-start;background:var(--ok);color:white}
    .sys{align-self:center;background:#0b1627;border:1px dashed var(--line);color:var(--muted)}
    .input{display:flex;gap:8px;border-top:1px solid var(--line);padding:10px}
    textarea{flex:1;background:#0c1728;border:1px solid var(--line);border-radius:10px;color:var(--text);padding:10px;resize:none;height:70px}
    textarea:focus{outline:none;border-color:var(--accent)}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}

    /* Sidebar */
    .side{display:flex;flex-direction:column;gap:var(--gap)}
    .statline{display:flex;align-items:center;gap:8px;margin-bottom:10px}
    .badge{padding:4px 10px;border-radius:999px;font-weight:800;font-size:12px}
    .b-high{background:var(--ok);color:#022a1f}
    .b-mid{background:var(--warn);color:#2a1f02}
    .b-low{background:var(--bad);color:#2a0202}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .kv{display:flex;justify-content:space-between;background:#0c1728;border:1px solid var(--line);padding:6px 8px;border-radius:8px;font-size:13px}

    .spark{height:64px;background:#0c1728;border:1px solid var(--line);border-radius:8px;padding:8px}
    .tags{display:flex;flex-wrap:wrap;gap:6px}
    .tag{background:#2a1b52;color:#e9d5ff;padding:3px 8px;border-radius:999px;font-size:11px}
    .tog{display:flex;gap:6px;flex-wrap:wrap}
    .chip{padding:6px 10px;border-radius:10px;border:1px solid var(--line);background:#0c1728;cursor:pointer}
    .chip.active{border-color:var(--accent);box-shadow:0 0 0 2px #22d3ee33}

    a.nav{color:#9fb3c8;text-decoration:none;padding:6px 10px;border-radius:8px;border:1px solid transparent}
    .nav:hover{border-color:#2a3b52;background:#0c1728}
    nav.menu{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;padding:10px 18px;border-top:1px solid var(--line);background:#0f172a}
  </style>
</head>
<body>
  <header>
    <div class="top">
      <span class="dot"></span>
      <div class="brand">LocalMediaSuite ¬∑ Flirt&nbsp;KI</div>
      <span class="dot"></span>
    </div>
    <nav class="menu">
      <a class="nav" href="index.html">Home</a>
      <a class="nav" href="image.html">Bild (SFW)</a>
      <a class="nav" href="image_nsfw.html">Bild (NSFW)</a>
      <a class="nav" href="video.html">Video (SFW)</a>
      <a class="nav" href="video_nsfw.html">Video (NSFW)</a>
      <a class="nav" href="gallery.html">Galerie</a>
      <a class="nav" href="catalog.html">Katalog</a>
      <a class="nav" href="settings.html">Settings</a>
    </nav>
  </header>

  <main class="wrap">
    <!-- Chat -->
    <section class="card">
      <div class="card-h">Chat</div>
      <div class="card-b">
        <div class="toolbar">
          <div class="field">
            üéØ <label for="age">Alter Zielperson</label>
            <input id="age" type="number" min="18" max="80" value="26" style="width:70px">
          </div>
          <div class="field">
            üéöÔ∏è Vibe
            <select id="vibe">
              <option value="locker" selected>locker</option>
              <option value="ausgewogen">ausgewogen</option>
              <option value="formell">formeller</option>
            </select>
          </div>
          <div class="field">
            üòä Laune
            <select id="mood">
              <option value="neutral" selected>neutral</option>
              <option value="gut">gut gelaunt</option>
              <option value="gestresst">gestresst</option>
              <option value="traurig">niedergeschlagen</option>
            </select>
          </div>
          <button class="btn" id="btnClear">Reset</button>
        </div>

        <div class="chat card">
          <div class="msgs" id="msgs">
            <div class="msg ai">Hi! Ich helfe dir, charmante Antworten zu formulieren ‚Äì inklusive Chancen‚ÄëEinsch√§tzung und Tipps passend zu Laune & Alter der Zielperson. üòä</div>
          </div>
          <div class="input">
            <textarea id="text" placeholder="Deine Nachricht oder der Chat‚ÄëVerlauf (einf√ºgen) ‚Ä¶"></textarea>
            <button class="btn primary" id="send">Senden</button>
          </div>
          <div class="card-b hint">Hinweis: Die Einsch√§tzungen sind heuristisch (Platzhalter‚ÄëKI). Du kannst sp√§ter deine richtige API unter <em>respondWithBackend()</em> anschlie√üen.</div>
        </div>
      </div>
    </section>

    <!-- Sidebar -->
    <aside class="side">
      <section class="card">
        <div class="card-h">üìä Live‚ÄëAnalyse</div>
        <div class="card-b">
          <div class="statline">
            <div>Flirt‚ÄëScore:</div>
            <div id="scoreBadge" class="badge b-mid">‚Äì%</div>
          </div>

          <div class="grid2" style="margin-bottom:10px">
            <div class="kv"><span>Interesse</span><strong id="pInterest">‚Äì%</strong></div>
            <div class="kv"><span>Humor</span><strong id="pHumor">‚Äì%</strong></div>
            <div class="kv"><span>Romantik</span><strong id="pRomance">‚Äì%</strong></div>
            <div class="kv"><span>Harmonie</span><strong id="pHarmony">‚Äì%</strong></div>
          </div>

          <div class="spark">
            <canvas id="spark" width="280" height="48"></canvas>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="card-h">üí° N√§chste Schritte</div>
        <div class="card-b">
          <div class="tags" id="tips">
            <!-- Tipps erscheinen hier -->
          </div>
        </div>
      </section>

      <section class="card">
        <div class="card-h">‚öôÔ∏è Optionen</div>
        <div class="card-b">
          <div class="tog">
            <div class="chip active" id="useHeuristics">Heuristik aktiv</div>
            <div class="chip" id="useBackend">Backend verwenden</div>
          </div>
          <div class="hint" style="margin-top:10px">
            Wenn <b>Backend verwenden</b> aktiv ist, wird <code>respondWithBackend()</code> aufgerufen (hier als Platzhalter implementiert).
          </div>
        </div>
      </section>
    </aside>
  </main>

  <script>
    // ------- State -------
    const msgs = document.getElementById('msgs');
    const text = document.getElementById('text');
    const moodSel = document.getElementById('mood');
    const ageInp = document.getElementById('age');
    const vibeSel = document.getElementById('vibe');

    const scoreBadge = document.getElementById('scoreBadge');
    const pInterest = document.getElementById('pInterest');
    const pHumor = document.getElementById('pHumor');
    const pRomance = document.getElementById('pRomance');
    const pHarmony = document.getElementById('pHarmony');
    const tipsBox = document.getElementById('tips');

    const spark = document.getElementById('spark');
    const ctx = spark.getContext('2d');
    const trend = [];

    let mode = 'heuristic'; // 'heuristic' | 'backend'

    // ------- UI helpers -------
    const add = (cls, content) => {
      const el = document.createElement('div');
      el.className = 'msg ' + cls;
      el.textContent = content;
      msgs.appendChild(el);
      msgs.scrollTop = msgs.scrollHeight;
      return el;
    };

    const setBadge = (score) => {
      scoreBadge.textContent = score + '%';
      scoreBadge.className = 'badge ' + (score>=80 ? 'b-high' : score>=60 ? 'b-mid' : 'b-low');
    };

    const drawTrend = () => {
      ctx.clearRect(0,0,spark.width,spark.height);
      if (trend.length < 2) return;
      const min = Math.min(...trend), max = Math.max(...trend);
      const r = (max-min) || 1;
      ctx.strokeStyle = '#22d3ee';
      ctx.lineWidth = 2;
      ctx.beginPath();
      trend.forEach((v,i)=>{
        const x = i/(trend.length-1)*(spark.width-16)+8;
        const y = spark.height-6 - ((v-min)/r)*(spark.height-16);
        i?ctx.lineTo(x,y):ctx.moveTo(x,y);
      });
      ctx.stroke();
      ctx.fillStyle = '#22d3ee';
      trend.forEach((v,i)=>{
        const x = i/(trend.length-1)*(spark.width-16)+8;
        const y = spark.height-6 - ((v-min)/r)*(spark.height-16);
        ctx.beginPath(); ctx.arc(x,y,2,0,6.283); ctx.fill();
      });
    };

    const chip = (txt)=> {
      const s = document.createElement('span'); s.className='tag'; s.textContent=txt; return s;
    };

    // ------- Heuristic "analysis" (lokal) -------
    function analyzeHeuristically(message, {mood, age, vibe}) {
      const m = message.toLowerCase();

      // einfache Features
      const positives = ['gern','mag','cool','spannend','s√º√ü','nett','danke','freu','wow','gern'];
      const compliments = ['sch√∂n','h√ºbsch','toll','fantastisch','beeindruckend'];
      const questions = (m.match(/\?/g)||[]).length;
      const hasEmoji = /[\u{1F600}-\u{1FAFF}]/u.test(m);

      let pos = positives.filter(w=>m.includes(w)).length;
      let comp = compliments.filter(w=>m.includes(w)).length;

      // Basisscores (0-100)
      let interest = 45 + pos*6 + questions*5;
      let humor = 40 + (hasEmoji?6:0) + (m.includes('witz')?10:0);
      let romance = 35 + comp*10 + (m.includes('date')?12:0);
      let harmony = 50 + pos*4 - (m.includes('nicht')?6:0);

      // Mood‚ÄëEinfluss
      const moodBoost = {
        neutral:{i:0,h:0,r:0,ha:0},
        gut:{i:8,h:10,r:4,ha:6},
        gestresst:{i:-6,h:-4,r:-2,ha:-8},
        traurig:{i:-4,h:-2,r:4,ha:-6}
      }[mood] || {i:0,h:0,r:0,ha:0};
      interest+=moodBoost.i; humor+=moodBoost.h; romance+=moodBoost.r; harmony+=moodBoost.ha;

      // Vibe/Alter ‚Üí Stil‚ÄëGewichtung (ohne Stereotype, nur Ton)
      const formality = vibe==='formell' ? 1 : vibe==='ausgewogen' ? 0.5 : 0;
      if (formality>0){ humor-=3*formality; romance+=2*formality; }
      if (age>=35){ harmony+=3; }
      if (age<=23){ humor+=4; }

      // clamp
      const clamp = v => Math.max(0, Math.min(100, Math.round(v)));
      interest=clamp(interest); humor=clamp(humor); romance=clamp(romance); harmony=clamp(harmony);
      const score = clamp(0.35*interest + 0.25*harmony + 0.25*humor + 0.15*romance);

      // Tipps
      const tips = [];
      if (humor<65) tips.push('Leichten Humor einbauen (eine lockere Frage + Emoji).');
      if (interest<70) tips.push('Offene Frage stellen, die zum Erz√§hlen einl√§dt.');
      if (romance<60 && vibe!=='formell') tips.push('Ein warmes, respektvolles Kompliment hilft.');
      if (harmony<65) tips.push('Sanfter Ton, aufgreifen was sie schrieb, Missverst√§ndnisse vermeiden.');
      tips.push(vibe==='formell' ? 'Etwas pr√§ziser & h√∂flicher formulieren.' :
               vibe==='locker' ? 'Locker bleiben, kurze S√§tze, positive Energie.' :
               'Ausgewogen: freundlich & klar.');

      // respons‚ÄëVorschlag
      const openers = [
        'Klingt spannend ‚Äì was hat dich daran am meisten gereizt?',
        'Mag ich! Erz√§hl mir mehr dar√ºber üòä',
        'Nice! Wie kam‚Äôs dazu?',
        'F√ºhlt sich gut an ‚Äì was w√§re dein perfekter n√§chster Schritt?'
      ];
      const compliment = 'Du hast eine sympathische Art ‚Äì das merkt man sofort.';
      const reply =
        (romance>70 && vibe!=='formell'
          ? `${compliment} ${openers[Math.floor(Math.random()*openers.length)]}`
          : openers[Math.floor(Math.random()*openers.length)]);

      return {score, interest, humor, romance, harmony, tips, reply};
    }

    // ------- Backend placeholder -------
    async function respondWithBackend(message, context){
      // >>>> HIER sp√§ter deine echte API nutzen <<<<
      // Platzhalter: nutzt die gleiche Heuristik und tut so, als w√§re es ‚Äûvom Server‚Äú.
      await new Promise(r=>setTimeout(r, 600));
      return analyzeHeuristically(message, context);
    }

    // ------- Actions -------
    document.getElementById('send').addEventListener('click', async ()=>{
      const message = text.value.trim();
      if (!message) return;
      add('me', message);
      text.value = '';

      const context = { mood: moodSel.value, age: Number(ageInp.value)||26, vibe: vibeSel.value };

      // Analyse
      const res = mode==='backend'
        ? await respondWithBackend(message, context)
        : analyzeHeuristically(message, context);

      // Anzeige
      setBadge(res.score);
      pInterest.textContent = res.interest+'%';
      pHumor.textContent = res.humor+'%';
      pRomance.textContent = res.romance+'%';
      pHarmony.textContent = res.harmony+'%';

      tipsBox.innerHTML='';
      res.tips.slice(0,4).forEach(t=>tipsBox.appendChild(chip(t)));

      // Trend
      trend.push(res.score); if (trend.length>20) trend.shift(); drawTrend();

      // Antwort
      add('ai', res.reply);
    });

    document.getElementById('btnClear').addEventListener('click', ()=>{
      msgs.innerHTML='';
      add('ai','Neustart. Schreib mir, worauf du antworten willst. üôÇ');
      [pInterest,pHumor,pRomance,pHarmony].forEach(e=>e.textContent='‚Äì%');
      setBadge(0); trend.length=0; drawTrend();
    });

    // Chips toggles
    const cHeu = document.getElementById('useHeuristics');
    const cBack = document.getElementById('useBackend');
    cHeu.addEventListener('click', ()=>{ mode='heuristic'; cHeu.classList.add('active'); cBack.classList.remove('active'); add('sys','Heuristik aktiviert'); });
    cBack.addEventListener('click', ()=>{ mode='backend'; cBack.classList.add('active'); cHeu.classList.remove('active'); add('sys','Backend‚ÄëModus aktiviert (Platzhalter)'); });

    // Enter = Senden
    text.addEventListener('keydown', e=>{
      if (e.key==='Enter' && !e.shiftKey){ e.preventDefault(); document.getElementById('send').click(); }
    });

    // Initial trend
    drawTrend();
  </script>
</body>
</html>
