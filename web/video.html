{
                id: 'animatediff-unrestricted',
                name: 'AnimateDiff (Unrestricted)',
                architecture: 'animatediff',
                description: 'Animation von Standbildern ohne Beschr√§nkungen',
                nsfw_capable: true,
                modalities: ['text2video', 'img2video']
              }
            ];
          }

          this.renderVideoModels(models);
        } catch (error) {
          console.error('Failed to load video models:', error);
          this.showMessage('Fehler beim Laden der Video-Modelle: ' + error.message, 'error');
          
          // Fallback Mock-Modelle
          this.renderVideoModels([
            {
              id: 'svd-unrestricted',
              name: 'SVD (Unrestricted)',
              architecture: 'svd',
              description: 'Premium Video-Generation ohne Filter',
              nsfw_capable: true
            }
          ]);
        }
      }

      renderVideoModels(models) {
        const container = document.getElementById('video-model-list');
        
        if (models.length === 0) {
          container.innerHTML = `
            <div class="status-text" style="color: #dc2626;">
              Keine Video-Modelle gefunden<br>
              <small>Installiere SVD oder andere Video-Modelle √ºber den Katalog</small>
            </div>
          `;
          return;
        }

        container.innerHTML = models.map(model => `
          <div class="model-option" data-model-id="${model.id}">
            <div style="flex: 1; z-index: 2; position: relative;">
              <div style="font-weight: 600; margin-bottom: 4px; display: flex; align-items: center; gap: 8px;">
                ${model.name}
                ${model.nsfw_capable ? '<span class="nsfw-badge">Unrestricted</span>' : ''}
              </div>
              <div style="font-size: 12px; color: #888;">
                ${model.architecture?.toUpperCase()} ‚Ä¢ ${model.description || 'Video-Generation'}
              </div>
              <div style="font-size: 11px; color: #666; margin-top: 2px;">
                Modi: ${(model.modalities || ['img2video']).join(', ')}
              </div>
            </div>
            <div style="width: 15px; height: 15px; border: 2px solid #e91e63; border-radius: 50%; z-index: 2; position: relative;"></div>
          </div>
        `).join('');

        // Add click handlers
        container.querySelectorAll('.model-option').forEach(option => {
          option.addEventListener('click', () => {
            this.selectVideoModel(option.dataset.modelId, option);
          });
        });

        // Auto-select first model
        if (models.length > 0) {
          const firstOption = container.querySelector('.model-option');
          this.selectVideoModel(models[0].id, firstOption);
        }
      }

      selectVideoModel(modelId, element) {
        // Remove previous selection
        document.querySelectorAll('.model-option').forEach(opt => {
          opt.classList.remove('selected');
        });

        // Select new model
        element.classList.add('selected');
        this.selectedModel = modelId;
        
        const modelName = element.querySelector('div').textContent;
        this.showMessage(`Unrestricted Video-Modell ausgew√§hlt: ${modelName}`, 'success');
      }

      handleVideoFileUpload(file) {
        if (!file) return;

        if (!file.type.startsWith('image/')) {
          this.showMessage('Bitte w√§hle eine g√ºltige Bilddatei f√ºr das Startbild', 'error');
          return;
        }

        if (file.size > 15 * 1024 * 1024) {
          this.showMessage('Bildgr√∂√üe sollte unter 15MB sein', 'error');
          return;
        }

        const reader = new FileReader();
        reader.onload = (e) => {
          this.uploadedImage = file;
          
          // Show upload preview
          const preview = document.getElementById('video-upload-preview');
          const previewImg = document.getElementById('video-upload-preview-img');
          previewImg.src = e.target.result;
          preview.style.display = 'block';

          // Update main preview with enhanced styling
          this.updateVideoPreview(`
            <div style="position: relative;">
              <img src="${e.target.result}" style="max-width: 100%; max-height: 420px; object-fit: contain; border-radius: 10px; box-shadow: 0 8px 32px rgba(233,30,99,0.3);">
              <div style="position: absolute; top: 15px; right: 15px; background: linear-gradient(45deg, #e91e63, #ff1493); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 600;">
                üé¨ Startbild geladen
              </div>
              <div style="position: absolute; bottom: 15px; left: 15px; right: 15px; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); color: white; padding: 12px; border-radius: 8px; font-size: 12px; text-align: center;">
                <div style="font-weight: 600; margin-bottom: 4px;">üé≠ Bereit f√ºr Unrestricted Animation</div>
                <div style="color: #e91e63;">Wird zu Video ohne jegliche Filter animiert</div>
              </div>
            </div>
          `);

          this.showMessage('Startbild f√ºr unrestricted Video erfolgreich hochgeladen', 'success');
        };
        reader.readAsDataURL(file);
      }

      calculateVideoSpecs() {
        const resolution = document.getElementById('video-resolution').value.split('x');
        const fps = parseInt(document.getElementById('fps').value);
        const duration = parseInt(document.getElementById('duration').value);
        const quality = document.getElementById('quality-level').value;
        
        this.videoSpecs = {
          width: parseInt(resolution[0]),
          height: parseInt(resolution[1]),
          fps: fps,
          duration: duration,
          frames: fps * duration,
          quality: quality
        };

        // Update display
        document.getElementById('total-frames').textContent = this.videoSpecs.frames;
        document.getElementById('current-quality').textContent = document.getElementById('quality-level').options[document.getElementById('quality-level').selectedIndex].text;
        
        // Enhanced size estimation based on quality
        const pixelsPerFrame = this.videoSpecs.width * this.videoSpecs.height;
        const qualityMultiplier = {
          'draft': 0.3,
          'standard': 1.0,
          'high': 2.0,
          'ultra': 3.5
        };
        const baseSize = (pixelsPerFrame * this.videoSpecs.frames * 3) / (1024 * 1024 * 8);
        const estimatedSize = Math.round(baseSize * qualityMultiplier[quality]);
        document.getElementById('estimated-size').textContent = `~${estimatedSize}MB`;
        
        // Enhanced time estimation
        const timeMultiplier = {
          'draft': 1.0,
          'standard': 1.5,
          'high': 2.5,
          'ultra': 4.0
        };
        const baseTime = Math.round((this.videoSpecs.frames * 4) / 60); // 4 sec per frame base
        const estimatedTime = Math.max(1, Math.round(baseTime * timeMultiplier[quality]));
        document.getElementById('estimated-time').textContent = `~${estimatedTime}min`;

        document.getElementById('frame-progress').textContent = `0/${this.videoSpecs.frames}`;
      }

      updateSliderValues() {
        document.getElementById('duration-value').textContent = document.getElementById('duration').value;
        document.getElementById('motion-value').textContent = document.getElementById('motion-bucket').value;
        document.getElementById('noise-value').textContent = parseFloat(document.getElementById('noise-aug').value).toFixed(2);
        document.getElementById('quality-display').textContent = document.getElementById('quality-level').options[document.getElementById('quality-level').selectedIndex].text;
      }

      async generateUnrestrictedVideo() {
        // Enhanced validation
        const prompt = document.getElementById('video-prompt').value.trim();
        const stylePrompt = document.getElementById('video-style-prompt').value.trim();
        
        if (!prompt) {
          this.showMessage('Bitte gib eine Video-Beschreibung ein', 'error');
          document.getElementById('video-prompt').focus();
          return;
        }

        if (!this.selectedModel) {
          this.showMessage('Bitte w√§hle ein Video-Modell aus', 'error');
          return;
        }

        if (this.currentMode === 'img2video' && !this.uploadedImage) {
          this.showMessage('F√ºr Bild-zu-Video ben√∂tigst du ein hochgeladenes Startbild', 'error');
          return;
        }

        this.isGenerating = true;
        this.updateVideoGenerateButton(true);
        this.showVideoProgress();

        try {
          // Prepare enhanced form data
          const formData = new FormData();
          
          // Combine prompts for better results
          let combinedPrompt = prompt;
          if (stylePrompt) {
            combinedPrompt += ', ' + stylePrompt;
          }
          
          formData.append('prompt', combinedPrompt);
          formData.append('model_id', this.selectedModel);
          formData.append('mode', this.currentMode);
          formData.append('nsfw', 'true'); // Enable unrestricted mode

          // Enhanced video parameters
          formData.append('width', this.videoSpecs.width.toString());
          formData.append('height', this.videoSpecs.height.toString());
          formData.append('fps', this.videoSpecs.fps.toString());
          formData.append('num_frames', this.videoSpecs.frames.toString());
          formData.append('motion_bucket_id', document.getElementById('motion-bucket').value);
          formData.append('noise_aug_strength', document.getElementById('noise-aug').value);

          // Quality settings
          formData.append('quality', this.videoSpecs.quality);

          // Seed for reproducibility
          const seed = document.getElementById('video-seed').value.trim();
          if (seed) {
            formData.append('seed', seed);
          }

          // Image for img2video
          if (this.currentMode === 'img2video' && this.uploadedImage) {
            formData.append('init_image', this.uploadedImage);
          }

          // Enhanced progress simulation
          this.simulateEnhancedVideoProgress();

          // Make API call to universal generation endpoint
          const response = await fetch('/api/generate/universal', {
            method: 'POST',
            body: formData
          });

          const data = await response.json();

          if (!data.ok) {
            throw new Error(data.error?.message || 'Unrestricted Video-Generation fehlgeschlagen');
          }

          // Show enhanced result
          this.showEnhancedVideoResult(data);
          this.showMessage('üé¨ Unrestricted Video erfolgreich generiert!', 'success');

        } catch (error) {
          console.error('Unrestricted video generation failed:', error);
          this.showMessage('Unrestricted Video-Generation fehlgeschlagen: ' + error.message, 'error');
        } finally {
          this.isGenerating = false;
          this.updateVideoGenerateButton(false);
          this.hideVideoProgress();
        }
      }

      simulateEnhancedVideoProgress() {
        const qualitySteps = {
          'draft': [
            { progress: 10, text: 'Unrestricted Modell laden...', eta: this.videoSpecs.frames * 2 },
            { progress: 25, text: 'Content-Filter deaktivieren...', eta: this.videoSpecs.frames * 1.8 },
            { progress: 45, text: 'Video frames generieren...', eta: this.videoSpecs.frames * 1.5 },
            { progress: 70, text: 'Bewegung berechnen...', eta: this.videoSpecs.frames * 1 },
            { progress: 85, text: 'Draft-Qualit√§t rendern...', eta: this.videoSpecs.frames * 0.5 },
            { progress: 95, text: 'Video finalisieren...', eta: 20 }
          ],
          'standard': [
            { progress: 8, text: 'Unrestricted Modell laden...', eta: this.videoSpecs.frames * 3 },
            { progress: 20, text: 'Erweiterte Parameter setzen...', eta: this.videoSpecs.frames * 2.5 },
            { progress: 35, text: 'High-Quality frames generieren...', eta: this.videoSpecs.frames * 2 },
            { progress: 55, text: 'Detaillierte Bewegung...', eta: this.videoSpecs.frames * 1.5 },
            { progress: 75, text: 'Standard-Qualit√§t rendern...', eta: this.videoSpecs.frames * 1 },
            { progress: 90, text: 'Optimierungen anwenden...', eta: 45 },
            { progress: 98, text: 'Video komprimieren...', eta: 15 }
          ],
          'high': [
            { progress: 5, text: 'High-Performance Modell laden...', eta: this.videoSpecs.frames * 4 },
            { progress: 15, text: 'Premium-Parameter konfigurieren...', eta: this.videoSpecs.frames * 3.5 },
            { progress: 25, text: 'Ultra-detaillierte Frames...', eta: this.videoSpecs.frames * 3 },
            { progress: 45, text: 'Komplexe Bewegungen...', eta: this.videoSpecs.frames * 2.5 },
            { progress: 65, text: 'High-Quality rendern...', eta: this.videoSpecs.frames * 2 },
            { progress: 80, text: 'Detail-Enhancement...', eta: this.videoSpecs.frames * 1.5 },
            { progress: 92, text: 'Qualit√§tskontrolle...', eta: 60 },
            { progress: 98, text: 'Finalisierung...', eta: 30 }
          ],
          'ultra': [
            { progress: 3, text: 'Ultra-Performance Modell initialisieren...', eta: this.videoSpecs.frames * 6 },
            { progress: 10, text: 'Maximum-Quality Setup...', eta: this.videoSpecs.frames * 5.5 },
            { progress: 20, text: 'Perfekte Frame-Generierung...', eta: this.videoSpecs.frames * 5 },
            { progress: 35, text: 'Ultra-detaillierte Bewegungen...', eta: this.videoSpecs.frames * 4 },
            { progress: 50, text: 'Ultra-High-Quality Rendering...', eta: this.videoSpecs.frames * 3.5 },
            { progress: 68, text: 'Advanced Post-Processing...', eta: this.videoSpecs.frames * 2.5 },
            { progress: 82, text: 'Perfektion-Enhancement...', eta: this.videoSpecs.frames * 1.5 },
            { progress: 93, text: 'Qualit√§tspr√ºfung...', eta: 90 },
            { progress: 98, text: 'Ultra-Finalisierung...', eta: 45 }
          ]
        };

        const steps = qualitySteps[this.videoSpecs.quality] || qualitySteps['standard'];
        let currentStep = 0;
        let simulatedFrames = 0;
        
        const interval = setInterval(() => {
          if (currentStep < steps.length && this.isGenerating) {
            const step = steps[currentStep];
            this.updateVideoProgress(step.progress, step.text);
            
            // Enhanced frame progress simulation
            const expectedFrames = Math.floor((step.progress / 100) * this.videoSpecs.frames);
            simulatedFrames = Math.min(expectedFrames, this.videoSpecs.frames);
            document.getElementById('frame-progress').textContent = `${simulatedFrames}/${this.videoSpecs.frames}`;
            document.getElementById('video-progress-percent').textContent = `${Math.round(step.progress)}%`;
            
            // Enhanced ETA calculation
            const etaMinutes = Math.floor(step.eta / 60);
            const etaSeconds = step.eta % 60;
            document.getElementById('eta-display').textContent = `${etaMinutes}:${etaSeconds.toString().padStart(2, '0')}`;
            
            currentStep++;
          } else if (!this.isGenerating) {
            clearInterval(interval);
          }
        }, this.videoSpecs.quality === 'draft' ? 1500 : 
            this.videoSpecs.quality === 'ultra' ? 3500 : 2500);
      }

      showVideoProgress() {
        document.getElementById('video-progress-container').style.display = 'block';
        this.updateVideoProgress(0, 'Starte Unrestricted Video-Generation...');
      }

      hideVideoProgress() {
        setTimeout(() => {
          document.getElementById('video-progress-container').style.display = 'none';
        }, 3000);
      }

      updateVideoProgress(percentage, text) {
        document.getElementById('video-progress-fill').style.width = `${percentage}%`;
        document.getElementById('video-status-text').textContent = text;
        document.getElementById('video-progress-percent').textContent = `${Math.round(percentage)}%`;
      }

      updateVideoGenerateButton(isGenerating) {
        const button = document.getElementById('video-generate-btn');
        
        if (isGenerating) {
          button.disabled = true;
          button.innerHTML = '‚è≥ Generiere Unrestricted Video...';
        } else {
          button.disabled = false;
          button.innerHTML = 'üé¨ Unrestricted Video Generieren';
        }
      }

      showEnhancedVideoResult(data) {
        const resultHtml = `
          <div style="position: relative;">
            <video 
              controls 
              style="max-width: 100%; max-height: 450px; border-radius: 12px; box-shadow: 0 12px 40px rgba(233,30,99,0.4);" 
              autoplay 
              muted 
              loop
              poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%23222' width='100' height='100'/%3E%3C/svg%3E"
            >
              <source src="${data.file}" type="video/mp4">
              Dein Browser unterst√ºtzt das Video-Element nicht.
            </video>
            
            <!-- Enhanced overlay badges -->
            <div style="position: absolute; top: 15px; left: 15px; display: flex; gap: 8px;">
              <span style="background: linear-gradient(45deg, #e91e63, #ff1493); color: white; padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: 700; text-transform: uppercase;">
                üîû Unrestricted
              </span>
              <span style="background: rgba(0,0,0,0.8); color: white; padding: 6px 10px; border-radius: 6px; font-size: 10px;">
                ${this.videoSpecs.quality.toUpperCase()}
              </span>
            </div>
            
            <!-- Enhanced info panel -->
            <div style="position: absolute; bottom: 15px; left: 15px; right: 15px; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); color: white; padding: 15px; border-radius: 10px; font-size: 13px;">
              <div style="font-weight: 700; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                ‚úÖ Unrestricted Video generiert!
                <span style="background: #10b981; padding: 2px 6px; border-radius: 4px; font-size: 10px;">SUCCESS</span>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px;">
                <div>üìê ${data.metadata?.resolution || `${this.videoSpecs.width}√ó${this.videoSpecs.height}`}</div>
                <div>üé¨ ${data.metadata?.frames || this.videoSpecs.frames} frames</div>
                <div>‚è±Ô∏è ${data.metadata?.duration_sec?.toFixed(1) || this.videoSpecs.duration}s</div>
                <div>üöÄ ${data.model || 'SVD'}</div>
              </div>
              ${data.metadata?.generation_time ? `<div style="margin-top: 6px; font-size: 10px; color: #888;">Generation: ${data.metadata.generation_time.toFixed(1)}s</div>` : ''}
            </div>
            
            <!-- Enhanced action buttons -->
            <div style="position: absolute; top: 15px; right: 15px; display: flex; gap: 8px;">
              <a href="${data.file}" download style="background: linear-gradient(45deg, #e91e63, #ff1493); color: white; padding: 8px 12px; border-radius: 8px; text-decoration: none; font-size: 11px; font-weight: 600; display: flex; align-items: center; gap: 4px; transition: transform 0.2s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                üì• Download
              </a>
              <a href="/gallery.html" style="background: linear-gradient(45deg, #10b981, #059669); color: white; padding: 8px 12px; border-radius: 8px; text-decoration: none; font-size: 11px; font-weight: 600; display: flex; align-items: center; gap: 4px; transition: transform 0.2s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                üé≠ Galerie
              </a>
            </div>
          </div>
        `;
        
        this.updateVideoPreview(resultHtml);
        
        // Auto-play success sound effect (if available)
        try {
          const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAIACD4BAAH8AQACACAAZGFOYQoAAAAAAAAAAAAAAAAAAAA=');
          audio.volume = 0.1;
          audio.play().catch(() => {}); // Silent fail if audio not supported
        } catch {}
      }

      updateVideoPreview(html) {
        const previewArea = document.getElementById('video-preview-area');
        previewArea.innerHTML = html;
        previewArea.classList.add('has-content');
      }

      showMessage(message, type = 'info') {
        const container = document.getElementById('message-container');
        
        const colors = {
          success: 'linear-gradient(135deg, #10b981, #059669)',
          error: 'linear-gradient(135deg, #dc2626, #b91c1c)',
          info: 'linear-gradient(135deg, #e91e63, #ff1493)'
        };

        const messageElement = document.createElement('div');
        messageElement.className = type === 'success' ? 'success-message' : 
                                 type === 'error' ? 'error-message' : 
                                 'success-message';
        messageElement.style.background = colors[type];
        messageElement.style.boxShadow = '0 4px 15px rgba(233,30,99,0.3)';
        messageElement.textContent = message;

        container.appendChild(messageElement);

        // Enhanced auto-removal with fade-out
        setTimeout(() => {
          messageElement.style.opacity = '0';
          messageElement.style.transform = 'translateY(-10px)';
          setTimeout(() => messageElement.remove(), 300);
        }, 4000);
      }
    }

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      new UnrestrictedVideoGenerator();
      
      // Add some additional enhanced styling
      const enhancedStyle = document.createElement('style');
      enhancedStyle.textContent = `
        @keyframes pulse-glow {
          0%, 100% { box-shadow: 0 0 20px rgba(233, 30, 99, 0.3); }
          50% { box-shadow: 0 0 30px rgba(233, 30, 99, 0.6); }
        }
        
        .model-option.selected {
          animation: pulse-glow 2s infinite;
        }
        
        .suggestion-chip:active {
          transform: scale(0.95);
        }
        
        .param-input:focus {
          animation: pulse-glow 0.5s ease;
        }
        
        video {
          transition: all 0.3s ease;
        }
        
        video:hover {
          transform: scale(1.02);
        }
      `;
      document.head.appendChild(enhancedStyle);
    });
  </script>
</body>
</html>